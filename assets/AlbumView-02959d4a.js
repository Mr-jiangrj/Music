import{a as e,l as a}from"./album-52ed55ed.js";import{P as s,Q as l,_ as t,R as n,S as o,a8 as r,a7 as i,am as c,r as m,j as u,z as d,U as p,M as g,N as h,O as k,Y as f,a2 as v,W as y,X as b,ao as w,h as $,at as j,ap as L,aA as _,aB as x,a1 as C,ad as M,Z as T,$ as U,ac as A,a6 as S,af as D,ag as H,aC as E,aJ as F,aD as P}from"./index-661ec728.js";import{D as W,M as I}from"./DataLists-57663f84.js";import{_ as q,g as z}from"./getCoverUrl-381066ed.js";import{a as B,L as N}from"./LinkTwo-82bd962a.js";import{U as R}from"./Unlike-f56e8f6e.js";import{M as O}from"./MusicList-860e954a.js";import{P as Q}from"./People-eef40241.js";import{T as V}from"./Time-52743681.js";import{_ as X}from"./Skeleton-e15f2934.js";import"./SmallSongData-3374c561.js";import"./Add-3dc646af.js";import"./FormItem-6ada1754.js";import"./Alert-dbc6e093.js";import"./ListAdd-a3933c80.js";import"./PlayOne-c57c555f.js";import"./Tooltip-7286355b.js";import"./use-houdini-0fca5f1d.js";const Y=s("city",!0,(function(e){return l("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[l("path",{d:"M4 42H44",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),l("rect",{x:"8",y:"26",width:"8",height:"16",rx:"2",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M12 34H13",stroke:e.colors[2],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),l("rect",{x:"16",y:"4",width:"24",height:"38",rx:"2",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null),l("rect",{x:"22",y:"10",width:"4",height:"4",fill:e.colors[2]},null),l("rect",{x:"30",y:"10",width:"4",height:"4",fill:e.colors[2]},null),l("rect",{x:"22",y:"17",width:"4",height:"4",fill:e.colors[2]},null),l("rect",{x:"30",y:"17",width:"4",height:"4",fill:e.colors[2]},null),l("rect",{x:"30",y:"24",width:"4",height:"4",fill:e.colors[2]},null),l("rect",{x:"30",y:"31",width:"4",height:"4",fill:e.colors[2]},null)])})),Z=e=>(D("data-v-07c30adf"),e=e(),H(),e),J={key:0,class:"album"},K={class:"left"},G={class:"cover"},ee=Z((()=>k("img",{src:"/images/pic/album.png",class:"album",alt:"album"},null,-1))),ae={class:"meta"},se={class:"title"},le={class:"intr"},te={class:"name"},ne={class:"desc text-hidden"},oe={class:"right"},re={class:"meta"},ie={class:"num"},ce={key:0,class:"num"},me={key:1,class:"title"},ue={class:"key"},de=Z((()=>k("br",null,null,-1))),pe={key:2,class:"loading"},ge={class:"left"},he={class:"right"},ke=t({__name:"AlbumView",setup(s){const{t:t}=n(),D=o(),H=r(),Z=i(),ke=c(),fe=m(D.currentRoute.value.query.id),ve=m(null),ye=m([]),be=m(!1),we=e=>()=>$(A,{style:{transform:"translateX(2px)"}},{default:()=>e}),$e=e=>{const a=H.getUserAlbumLists.list;return!a.length||!a.some((a=>a.id===Number(e)))},je=m([]),Le=()=>{je.value=[{key:"copy",label:t("menu.copy",{name:t("general.name.album"),other:t("general.name.link")}),props:{onClick:()=>{if(navigator.clipboard)try{navigator.clipboard.writeText(`https://music.163.com/#/playlist?id=${fe.value}`),$message.success(t("general.message.copySuccess"))}catch(e){console.error(t("general.message.copyFailure"),e),$message.error(t("general.message.copyFailure"))}else $message.error(t("general.message.notSupported"))}},icon:we($(B))},{key:"like",label:$e(fe.value)?t("menu.collection",{name:t("general.name.album")}):t("menu.cancelCollection",{name:t("general.name.album")}),show:H.userLogin,props:{onClick:()=>{Ce(fe.value)}},icon:we($($e(fe.value)?N:R))}]},_e=a=>{e(a).then((e=>{ve.value=e.album,$setSiteTitle(e.album.name+" - "+t("general.name.album")),e.songs?(ye.value=[],e.songs.forEach(((e,s)=>{ye.value.push({id:e.id,num:s+1,name:e.name,artist:e.ar,album:e.al,alia:e.alia,time:j(e.dt),fee:e.fee,sourceId:a,pc:e.pc?e.pc:null,mv:e.mv?e.mv:null})}))):$message.error(t("general.message.acquisitionFailed"))}))},xe=()=>{try{const e=document.getElementById("datalists").firstElementChild,a=document.querySelectorAll("#datalists > *");let s=!1;if(a.forEach((e=>{e.classList.contains("play")&&(s=!0)})),s)Z.setPlayState(!0);else{const a=new MouseEvent("dblclick",{bubbles:!0,cancelable:!0,view:window});"dblclick"===ke.listClickMode?e.dispatchEvent(a):"click"===ke.listClickMode&&e.click()}}catch(e){console.error($message.error(t("general.message.operationFailed")),e),$message.error($message.error(t("general.message.operationFailed")))}},Ce=async e=>{const s=$e(e)?1:2,l=t("general.name.album"),n="zh-CN"===ke.language?"":" ";try{200===(await a(s,e)).code?($message.success(`${l+n}${t(1==s?"menu.collection":"menu.cancelCollection",{name:t("general.dialog.success")})}`),H.setUserAlbumLists((()=>{Le()}))):$message.error(`${l+n}${t(1==s?"menu.collection":"menu.cancelCollection",{name:t("general.dialog.failed")})}`)}catch(o){$message.error(`${l+n}${t(1==s?"menu.collection":"menu.cancelCollection",{name:t("general.dialog.failed")})}`),console.error(`${l+n}${t(1==s?"menu.collection":"menu.cancelCollection",{name:t("general.dialog.failed")})}`,o)}};return u((()=>{fe.value&&(_e(fe.value),!H.userLogin||H.getUserAlbumLists.has||H.getUserAlbumLists.isLoading?Le():H.setUserAlbumLists((()=>{Le()})))})),d((()=>D.currentRoute.value),(e=>{fe.value=e.query.id,"album"==e.name&&_e(fe.value)})),(e,a)=>{var s;const t=q,n=L,o=E,r=_,i=F,c=P,m=x,u=X;return p(ve)?(g(),h("div",J,[k("div",K,[k("div",G,[l(t,{"show-toolbar-tooltip":"",class:"coverImg",src:p(z)(p(ve).picUrl,1024),"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":p(z)(p(ve).picUrl),"fallback-src":"/images/pic/default.png"},null,8,["src","preview-src"]),ee]),k("div",ae,[k("div",se,[l(p(M),{class:"name"},{default:f((()=>[C(v(p(ve).name),1)])),_:1}),l(p(M),{class:"creator",onClick:a[0]||(a[0]=e=>p(D).push(`/artist/songs?id=${p(ve).artist.id}`))},{default:f((()=>[C(v(p(ve).artist.name),1)])),_:1})]),k("div",le,[k("span",te,v(e.$t("general.name.desc",{name:e.$t("general.name.album")})),1),k("span",ne,v(p(ve).description?p(ve).description:e.$t("other.noDesc")),1),(null==(s=p(ve))?void 0:s.description.length)>70?(g(),y(n,{key:0,class:"all-desc",block:"",strong:"",secondary:"",onClick:a[1]||(a[1]=e=>be.value=!0)},{default:f((()=>[C(v(e.$t("general.name.allDesc")),1)])),_:1})):b("",!0)]),p(ve).tags?(g(),y(r,{key:0,class:"tag"},{default:f((()=>[(g(!0),h(T,null,U(p(ve).tags,(e=>(g(),y(o,{class:"tags",round:"",bordered:!1,key:e},{default:f((()=>[C(v(e),1)])),_:2},1024)))),128))])),_:1})):b("",!0),l(r,{class:"control"},{default:f((()=>[l(n,{strong:"",secondary:"",round:"",type:"primary",onClick:xe},{icon:f((()=>[l(p(A),{component:p(O)},null,8,["component"])])),default:f((()=>[C(" "+v(e.$t("general.name.play")),1)])),_:1}),l(i,{placement:"right-start",trigger:"click","show-arrow":!0,options:p(je)},{default:f((()=>[l(n,{strong:"",secondary:"",circle:""},{icon:f((()=>[l(p(A),{component:p(I)},null,8,["component"])])),_:1})])),_:1},8,["options"])])),_:1})])]),k("div",oe,[k("div",re,[l(p(M),{class:"name"},{default:f((()=>[C(v(p(ve).name),1)])),_:1}),l(p(M),{class:"creator",onClick:a[2]||(a[2]=e=>p(D).push(`/artist/songs?id=${p(ve).artist.id}`))},{default:f((()=>[l(p(A),{depth:3,component:p(Q)},null,8,["component"]),C(" "+v(p(ve).artist.name),1)])),_:1}),l(r,{class:"time"},{default:f((()=>[k("div",ie,[l(p(A),{depth:3,component:p(V)},null,8,["component"]),l(p(M),{innerHTML:p(S)(p(ve).publishTime)},null,8,["innerHTML"])]),p(ve).company?(g(),h("div",ce,[l(p(A),{depth:3,component:p(Y)},null,8,["component"]),l(p(M),{innerHTML:p(ve).company},null,8,["innerHTML"])])):b("",!0)])),_:1})]),l(W,{listData:p(ye),hideAlbum:""},null,8,["listData"]),l(m,{class:"s-modal",show:p(be),"onUpdate:show":a[3]||(a[3]=e=>w(be)?be.value=e:null),preset:"card",title:e.$t("general.name.desc",{name:e.$t("general.name.album")}),bordered:!1},{default:f((()=>[l(c,null,{default:f((()=>[l(p(M),{innerHTML:p(ve).description.replace(/\n/g,"<br>")},null,8,["innerHTML"])])),_:1})])),_:1},8,["show","title"])])])):p(fe)?(g(),h("div",pe,[k("div",ge,[l(u,{class:"pic"}),l(u,{text:"",repeat:5}),l(u,{text:"",style:{width:"60%"}})]),k("div",he,[l(u,{sharp:!1,height:"80px",width:"60%"}),l(u,{height:"100%",width:"100%"})])])):(g(),h("div",me,[k("span",ue,v(e.$t("general.name.noKeywords")),1),de,l(n,{strong:"",secondary:"",onClick:a[4]||(a[4]=e=>p(D).go(-1)),style:{"margin-top":"20px"}},{default:f((()=>[C(v(e.$t("general.name.goBack")),1)])),_:1})]))}}},[["__scopeId","data-v-07c30adf"]]);export{ke as default};
