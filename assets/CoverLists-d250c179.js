import{P as e,Q as l,R as s,a7 as a,a8 as t,r as o,M as i,W as r,Y as n,a1 as u,a2 as c,U as d,ao as p,bC as m,bD as g,ap as y,aA as h,aB as k,_ as v,S as f,am as b,j as C,N as w,Z as L,$,O as _,ac as U,X as T,ah as x,T as j,A as R,h as P,a$ as z,b2 as M,aJ as H,b3 as V}from"./index-661ec728.js";import{l as A}from"./album-52ed55ed.js";import{_ as D,a as S}from"./FormItem-6ada1754.js";import{_ as N}from"./Select-289431c4.js";import{g as W,_ as Z}from"./getCoverUrl-381066ed.js";import{P as q}from"./PlayOne-c57c555f.js";import{L as B,a as E,_ as F}from"./LinkTwo-82bd962a.js";import{U as I}from"./Unlike-f56e8f6e.js";import{a as Q,_ as X}from"./Grid-8b78ec37.js";import{_ as O}from"./Skeleton-e15f2934.js";const Y=e("editor",!0,(function(e){return l("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[l("path",{d:"M40 33V42C40 43.1046 39.1046 44 38 44H31.5",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M40 16V6C40 4.89543 39.1046 4 38 4H10C8.89543 4 8 4.89543 8 6V42C8 43.1046 8.89543 44 10 44H16",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M16 16H30",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap},null),l("path",{d:"M23 44L40 23",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap},null),l("path",{d:"M16 24H24",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap},null)])})),G=e("headset",!1,(function(e){return l("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[l("path",{d:"M42 30V24.4615C42 14.2655 33.9411 6 24 6C14.0589 6 6 14.2655 6 24.4615V30",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M34 32C34 29.7909 35.7909 28 38 28H42V42H38C35.7909 42 34 40.2091 34 38V32Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M42 32H44C45.1046 32 46 32.8954 46 34V36C46 37.1046 45.1046 38 44 38H42V32Z",fill:e.colors[0]},null),l("path",{d:"M6 32H4C2.89543 32 2 32.8954 2 34V36C2 37.1046 2.89543 38 4 38H6V32Z",fill:e.colors[0]},null),l("path",{d:"M6 28H10C12.2091 28 14 29.7909 14 32V38C14 40.2091 12.2091 42 10 42H6V28Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null)])})),J={__name:"PlaylistUpdate",setup(e,{expose:v}){const{t:f}=s(),{textRule:b}={textRule:{required:!0,message:"请填写必要信息",trigger:"blur"},numberRule:{type:"number",required:!0,message:"请填写必要信息",trigger:"blur"},emailRule:{required:!0,validator:(e,l)=>l?!!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(l)||new Error("请输入正确的电子邮箱"):new Error("请输入电子邮箱"),trigger:["input","blur"]},mobileRule:{key:"phone",required:!0,validator:(e,l)=>l?!!/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[1589]))\d{8}$/.test(l)||new Error("请输入正确的手机号码"):new Error("请输入手机号码"),trigger:["input","blur"]}},C=a(),w=t(),L=o(null),$=o(null),_=o(!1),U={name:b},T=o({name:null,desc:null,tags:null}),x=e=>{var l;e.preventDefault(),null==(l=$.value)||l.validate((e=>{e?($loadingBar.error(),$message.error(f("general.message.needCheck"))):m(L.value,T._value.name,T._value.desc,T._value.tags.join(";")).then((e=>{200===e.code?($message.success(f("general.message.editorSuccess")),P(),w.setUserPlayLists()):$message.error(f("general.message.editorFailed"))}))}))},j=o([]),R=()=>{C.catList.sub?j.value=C.catList.sub.map((e=>({label:e.name,value:e.name}))):C.setCatList()},P=()=>{_.value=!1,L.value=null};return v({openUpdateModal:e=>{T.value={name:e.name,desc:e.desc,tags:e.tags},L.value=e.id,_.value=!0}}),(e,s)=>{const a=g,t=D,o=N,m=S,v=y,f=h,b=k;return i(),r(b,{class:"s-modal",show:d(_),"onUpdate:show":s[3]||(s[3]=e=>p(_)?_.value=e:null),preset:"card",title:e.$t("menu.update"),bordered:!1,"on-after-leave":P},{footer:n((()=>[l(f,{justify:"end"},{default:n((()=>[l(v,{onClick:P},{default:n((()=>[u(c(e.$t("general.dialog.cancel")),1)])),_:1}),l(v,{type:"primary",onClick:x},{default:n((()=>[u(c(e.$t("general.dialog.editor")),1)])),_:1})])),_:1})])),default:n((()=>[l(m,{ref_key:"playlistUpdateRef",ref:$,rules:U,"label-width":80,model:d(T)},{default:n((()=>[l(t,{label:e.$t("other.plName"),path:"name"},{default:n((()=>[l(a,{value:d(T).name,"onUpdate:value":s[0]||(s[0]=e=>d(T).name=e),placeholder:e.$t("other.plNameTip")},null,8,["value","placeholder"])])),_:1},8,["label"]),l(t,{label:e.$t("other.plDes"),path:"desc"},{default:n((()=>[l(a,{value:d(T).desc,"onUpdate:value":s[1]||(s[1]=e=>d(T).desc=e),type:"textarea",placeholder:e.$t("other.plDesTip"),autosize:{minRows:3,maxRows:5}},null,8,["value","placeholder"])])),_:1},8,["label"]),l(t,{label:e.$t("other.plTag"),path:"tags"},{default:n((()=>[l(o,{multiple:"",value:d(T).tags,"onUpdate:value":s[2]||(s[2]=e=>d(T).tags=e),placeholder:e.$t("other.plTagTip"),options:d(j),onClick:R},null,8,["value","placeholder","options"])])),_:1},8,["label"])])),_:1},8,["model"])])),_:1},8,["show","title"])}}},K={class:"coverlists"},ee={class:"cover"},le={class:"cover-loading"},se={key:0,class:"description"},ae={key:0,class:"num"},te={class:"des"},oe={key:1,class:"num"},ie={class:"des"},re={class:"title"},ne={class:"name text-hidden"},ue={key:0,class:"by"},ce={key:1,class:"by"},de=v({__name:"CoverLists",props:{listData:{type:Array,default:[]},listType:{type:String,default:"playlist"},columns:{type:String,default:"3 s:4 m:5 l:6"},gridCollapsed:{type:Boolean,default:!1},gridCollapsedRows:{type:Number,default:2},loadingNum:{type:Number,default:30}},setup(e){const u=e,{t:p}=s(),m=f(),g=a(),y=t(),h=b(),k=o(null),v=e=>()=>P(U,{style:{transform:"translateX(2px)"}},{default:()=>e}),D=o(0),S=o(0),N=o(!1),de=o(null),pe=()=>{N.value=!1},me=e=>{var l;if(e.id===(null==(l=y.getUserPlayLists)?void 0:l.own[0].id))return $message.warning(p("menu.unableToDelete")),!1;$dialog.warning({class:"s-dialog",title:p("general.dialog.delete"),content:p("menu.delQuestion",{name:e.name}),positiveText:p("general.dialog.delete"),negativeText:p("general.dialog.cancel"),onPositiveClick:()=>{M(e.id).then((e=>{200===e.code&&($message.success(p("general.message.deleteSuccess")),y.setUserPlayLists())}))}})},ge=e=>{const l=u.listType,s=y.getUserPlayLists.like,a=y.getUserAlbumLists.list;return"playlist"===l&&s.length?!s.some((l=>l.id===Number(e))):"album"!==l||!a.length||!a.some((l=>l.id===Number(e)))},ye=async e=>{const l=u.listType,s=ge(e)?1:2,a="playlist"===l?V:A,t=p("playlist"===l?"general.name.playlist":"general.name.album"),o="zh-CN"===h.language?"":" ";try{200===(await a(s,e)).code?($message.success(`${t+o}${p(1==s?"menu.collection":"menu.cancelCollection",{name:p("general.dialog.success")})}`),"playlist"===l?y.setUserPlayLists():y.setUserAlbumLists()):$message.error(`${t+o}${p(1==s?"menu.collection":"menu.cancelCollection",{name:p("general.dialog.failed")})}`)}catch(i){$message.error(`${t+o}${p(1==s?"menu.collection":"menu.cancelCollection",{name:p("general.dialog.failed")})}`),console.error(`${t+o}${p(1==s?"menu.collection":"menu.cancelCollection",{name:p("general.dialog.failed")})}`,i)}};return C((()=>{"user-playlists"!==m.currentRoute.value.name||g.catList.sub||g.setCatList(),!y.userLogin||y.getUserPlayLists.has||y.getUserPlayLists.isLoading||"playlist"!==u.listType||y.setUserPlayLists(),!y.userLogin||y.getUserAlbumLists.has||y.getUserAlbumLists.isLoading||"album"!==u.listType||y.setUserAlbumLists()})),(s,a)=>{const t=F,o=Z,g=Q,h=X,f=O,b=H;return i(),w("div",K,[l(j,{mode:"out-in"},{default:n((()=>[e.listData[0]?(i(),r(h,{key:0,"x-gap":"20","y-gap":"26",responsive:"screen",cols:e.columns,collapsed:e.gridCollapsed,"collapsed-rows":e.gridCollapsedRows},{default:n((()=>[(i(!0),w(L,null,$(e.listData,(s=>(i(),r(g,{class:"item",key:s,onClick:e=>{return l=s.id,void("playlist"===u.listType||"topList"===u.listType?m.push({path:"/playlist",query:{id:l,page:1}}):"album"===u.listType&&m.push({path:"/album",query:{id:l}}));var l},onContextmenu:e=>{return a=s,(l=e).preventDefault(),N.value=!1,void R().then((()=>{de.value=[{key:"update",label:p("menu.update"),show:"user-playlists"===m.currentRoute.value.name,props:{onClick:()=>{k.value.openUpdateModal(a)}},icon:v(P(Y))},{key:"del",label:p("menu.del"),show:"user-playlists"===m.currentRoute.value.name,props:{onClick:()=>{me(a)}},icon:v(P(z))},{key:"likePlaylist",label:ge(a.id)?p("menu.collection",{name:p("general.name.playlist")}):p("menu.cancelCollection",{name:p("general.name.playlist")}),show:!(!y.userLogin||!y.getUserPlayLists.has||"playlist"!==u.listType||"user-playlists"===m.currentRoute.value.name),props:{onClick:()=>{ye(a.id)}},icon:v(P(ge(a.id)?B:I))},{key:"likeAlbum",label:ge(a.id)?p("menu.collection",{name:p("general.name.album")}):p("menu.cancelCollection",{name:p("general.name.album")}),show:!(!y.userLogin||!y.getUserAlbumLists.has||"album"!==u.listType),props:{onClick:()=>{ye(a.id)}},icon:v(P(ge(a.id)?B:I))},{key:"copy",label:p("menu.copy",{name:"playlist"===u.listType?p("general.name.playlist"):p("general.name.album"),other:p("general.name.link")}),props:{onClick:()=>{if(navigator.clipboard)try{navigator.clipboard.writeText(`https://music.163.com/#/${"playlist"===u.listType?"playlist":"album"}?id=${a.id}`),$message.success(p("general.message.copySuccess"))}catch(e){console.error(p("general.message.copyFailure"),e),$message.error(p("general.message.copyFailure"))}else $message.error(p("general.message.notSupported"))}},icon:v(P(E))}],N.value=!0,D.value=l.clientX,S.value=l.clientY}));var l,a}},{default:n((()=>[_("div",ee,[l(o,{lazy:"",class:"coverImg","preview-disabled":"",src:d(W)(s.cover,300),"fallback-src":"/images/pic/default.png"},{placeholder:n((()=>[_("div",le,[l(t,{size:"small"})])])),_:2},1032,["src"]),l(o,{lazy:"",class:"shadow","preview-disabled":"",src:d(W)(s.cover,300),"fallback-src":"/images/pic/default.png"},null,8,["src"]),l(d(U),{class:"play",size:"40"},{default:n((()=>[l(d(q),{theme:"filled"})])),_:1}),"topList"!=e.listType?(i(),w("div",se,["playlist"==e.listType?(i(),w("div",ae,[l(d(U),null,{default:n((()=>[l(d(G),{theme:"filled"})])),_:1}),_("span",te,c(s.playCount),1)])):(i(),w("div",oe,[_("span",ie,c(s.time),1)]))])):T("",!0)]),_("div",re,[_("span",ne,c(s.name),1),"playlist"==e.listType&&s.artist?(i(),w("span",ue," By "+c(s.artist.nickname),1)):"topList"==e.listType&&s.update?(i(),w("span",ce,c(s.update),1)):(i(),r(x,{key:2,class:"text-hidden",artistsData:s.artist},null,8,["artistsData"]))])])),_:2},1032,["onClick","onContextmenu"])))),128))])),_:1},8,["cols","collapsed","collapsed-rows"])):(i(),r(h,{key:1,class:"loading","x-gap":"20","y-gap":"26",cols:e.columns,responsive:"screen",collapsed:e.gridCollapsed,"collapsed-rows":e.gridCollapsedRows},{default:n((()=>[(i(!0),w(L,null,$(e.loadingNum,(e=>(i(),r(g,{class:"item",key:e},{default:n((()=>[l(f,{class:"pic",sharp:!1}),l(f,{text:"",repeat:1}),l(f,{text:"",style:{width:"60%"}})])),_:2},1024)))),128))])),_:1},8,["cols","collapsed","collapsed-rows"]))])),_:1}),l(b,{style:{"--n-font-size":"14px","--n-border-radius":"6px"},placement:"bottom-start",trigger:"manual",size:"large",x:d(D),y:d(S),options:d(de),show:d(N),"on-clickoutside":pe,onSelect:a[0]||(a[0]=e=>N.value=!1)},null,8,["x","y","options","show"]),l(J,{ref_key:"playlistUpdateRef",ref:k},null,512)])}}},[["__scopeId","data-v-a0fac1e4"]]);export{de as C};
